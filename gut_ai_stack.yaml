AWSTemplateFormatVersion: 2010-09-09


Resources:

  GutAITable:
    Type: AWS::DynamoDB::Table
    Properties: 
      AttributeDefinitions: 
        - 
          AttributeName: nameId
          AttributeType: S
        - 
          AttributeName: entryId
          AttributeType: S
      KeySchema: 
        - 
          AttributeName: nameId
          KeyType: HASH
        - 
          AttributeName: entryId
          KeyType: RANGE
      BillingMode: PROVISIONED
      ProvisionedThroughput: 
        ReadCapacityUnits: 5
        WriteCapacityUnits: 5
      TableName: GutAITable




  DynamoDBRole:
    Type: AWS::IAM::Role
    Properties:
      RoleName: gut-ai-appsync-dynamodb-role
      ManagedPolicyArns:
        - Ref: AppSyncDynamoDBPolicy
      AssumeRolePolicyDocument:
        Version: 2012-10-17
        Statement:
          - Effect: Allow
            Action:
              - sts:AssumeRole
            Principal:
              Service:
                - appsync.amazonaws.com
    DependsOn:
      - AppSyncDynamoDBPolicy

  CloudWatchRole:
    Type: AWS::IAM::Role
    Properties:
      RoleName: gut-ai-cloudwatch-role
      ManagedPolicyArns:
        - Ref: AWSAppSyncPushToCloudWatchLogsRole
      AssumeRolePolicyDocument:
        Version: 2012-10-17
        Statement:
          - Effect: Allow
            Action:
              - sts:AssumeRole
            Principal:
              Service:
                - appsync.amazonaws.com
    DependsOn:
      - AWSAppSyncPushToCloudWatchLogsRole

  AppSyncDynamoDBPolicy:
    Type: AWS::IAM::ManagedPolicy
    Properties:
      Description: Managed policy to allow AWS AppSync to access the tables created by this template.
      Path: /appsync/
      PolicyDocument:
        Version: 2012-10-17
        Statement:
          - Effect: Allow
            Action:
              - dynamodb:GetItem
              - dynamodb:PutItem
              - dynamodb:DeleteItem
              - dynamodb:UpdateItem
              - dynamodb:Query
              - dynamodb:Scan
              - dynamodb:BatchGetItem
              - dynamodb:BatchWriteItem
            Resource: !Join [ "", [ !GetAtt GutAITable.Arn, "*" ] ]

  AWSAppSyncPushToCloudWatchLogsRole:
    Type: AWS::IAM::ManagedPolicy
    Properties:
      Description: Managed policy to allow AWS AppSync to push to CloudWatch Logs.
      Path: /appsync/
      PolicyDocument:
        Version: 2012-10-17
        Statement:
          - Effect: Allow
            Action:
              - logs:CreateLogGroup
              - logs:CreateLogStream
              - logs:PutLogEvents
            Resource: "*"

  AppSyncAPI:
    Type: AWS::AppSync::GraphQLApi
    Properties: 
      AuthenticationType: API_KEY
      Name: GutAIAppSync
      LogConfig:
        CloudWatchLogsRoleArn: !GetAtt CloudWatchRole.Arn
        FieldLogLevel: ALL

  
  GraphQLSchema:
    Type: AWS::AppSync::GraphQLSchema
    Properties: 
      ApiId: !GetAtt AppSyncAPI.ApiId
      DefinitionS3Location: schema.graphql


  AppSyncDataSource:
    Type: AWS::AppSync::DataSource    
    Properties:
      ApiId: !GetAtt AppSyncAPI.ApiId
      Name: GutAITable
      Description: The Gut AI DynamoDB table in us-east-1
      Type: AMAZON_DYNAMODB
      ServiceRoleArn: !GetAtt DynamoDBRole.Arn
      DynamoDBConfig:
        TableName: !Ref GutAITable
        AwsRegion: !Sub ${AWS::Region}

# Food Resolvers

  AppSyncListFoodsQueryResolver:
    Type: "AWS::AppSync::Resolver"
    DependsOn: GraphQLSchema
    Properties:
      ApiId: !GetAtt AppSyncAPI.ApiId
      TypeName: Query
      FieldName: listFoods
      DataSourceName: !GetAtt AppSyncDataSource.Name
      RequestMappingTemplateS3Location: resolver/food/listFoodsRequest.vtl
      ResponseMappingTemplate: "$util.toJson($context.result)"

  AppSyncGetFoodQueryResolver:
    Type: "AWS::AppSync::Resolver"
    DependsOn: GraphQLSchema
    Properties:
      ApiId: !GetAtt AppSyncAPI.ApiId
      TypeName: Query
      FieldName: getFood
      DataSourceName: !GetAtt AppSyncDataSource.Name
      RequestMappingTemplateS3Location: resolver/food/getFoodRequest.vtl
      ResponseMappingTemplate: "$util.toJson($ctx.result)"

  AppSyncCreateFoodMutationResolver:
    Type: "AWS::AppSync::Resolver"
    DependsOn: GraphQLSchema
    Properties:
      ApiId: !GetAtt AppSyncAPI.ApiId
      TypeName: Mutation
      FieldName: createFood
      DataSourceName: !GetAtt AppSyncDataSource.Name
      RequestMappingTemplateS3Location: resolver/food/createFoodRequest.vtl
      ResponseMappingTemplate: "$util.toJson($ctx.result)"

  AppSyncUpdateFoodMutationResolver:
    Type: "AWS::AppSync::Resolver"
    DependsOn: GraphQLSchema
    Properties:
      ApiId: !GetAtt AppSyncAPI.ApiId
      TypeName: Mutation
      FieldName: updateFood
      DataSourceName: !GetAtt AppSyncDataSource.Name
      RequestMappingTemplateS3Location: resolver/food/updateFoodRequest.vtl
      ResponseMappingTemplate: "$util.toJson($ctx.result)"

  AppSyncDeleteFoodMutationResolver:
    Type: "AWS::AppSync::Resolver"
    DependsOn: GraphQLSchema
    Properties:
      ApiId: !GetAtt AppSyncAPI.ApiId
      TypeName: Mutation
      FieldName: deleteFood
      DataSourceName: !GetAtt AppSyncDataSource.Name
      RequestMappingTemplateS3Location: resolver/food/deleteFoodRequest.vtl
      ResponseMappingTemplate: "$util.toJson($ctx.result)"

# Ingredient Resolvers

  AppSyncListIngredientsQueryResolver:
    Type: "AWS::AppSync::Resolver"
    DependsOn: GraphQLSchema
    Properties:
      ApiId: !GetAtt AppSyncAPI.ApiId
      TypeName: Query
      FieldName: listIngredients
      DataSourceName: !GetAtt AppSyncDataSource.Name
      RequestMappingTemplateS3Location: resolver/ingredient/listIngredientsRequest.vtl
      ResponseMappingTemplate: "$util.toJson($context.result)"

  AppSyncGetIngredientQueryResolver:
    Type: "AWS::AppSync::Resolver"
    DependsOn: GraphQLSchema
    Properties:
      ApiId: !GetAtt AppSyncAPI.ApiId
      TypeName: Query
      FieldName: getIngredient
      DataSourceName: !GetAtt AppSyncDataSource.Name
      RequestMappingTemplateS3Location: resolver/ingredient/getIngredientRequest.vtl
      ResponseMappingTemplate: "$util.toJson($ctx.result)"

  AppSyncCreateIngredientMutationResolver:
    Type: "AWS::AppSync::Resolver"
    DependsOn: GraphQLSchema
    Properties:
      ApiId: !GetAtt AppSyncAPI.ApiId
      TypeName: Mutation
      FieldName: createIngredient
      DataSourceName: !GetAtt AppSyncDataSource.Name
      RequestMappingTemplateS3Location: resolver/ingredient/createIngredientRequest.vtl
      ResponseMappingTemplate: "$util.toJson($ctx.result)"

  AppSyncAddIngredientMutationResolver:
    Type: "AWS::AppSync::Resolver"
    DependsOn: GraphQLSchema
    Properties:
      ApiId: !GetAtt AppSyncAPI.ApiId
      TypeName: Mutation
      FieldName: addIngredient
      DataSourceName: !GetAtt AppSyncDataSource.Name
      Kind: PIPELINE
      PipelineConfig:
        Functions:
          - !GetAtt AppSyncCreateIngredientFunction.FunctionId
          - !GetAtt AppSyncGetDiaryEntryFromIngredientFunction.FunctionId
          - !GetAtt AppSyncLinkIngredientDiaryEntryFunction.FunctionId
      RequestMappingTemplate: "$util.toJson($ctx.args)"
      ResponseMappingTemplate: "$util.toJson($ctx.result)"

  AppSyncCreateIngredientFunction:
    Type: "AWS::AppSync::FunctionConfiguration"
    DependsOn: GraphQLSchema
    Properties:
      ApiId: !GetAtt AppSyncAPI.ApiId
      DataSourceName: !GetAtt AppSyncDataSource.Name
      FunctionVersion: 2018-05-29
      Name: createIngredientFunction
      RequestMappingTemplateS3Location: resolver/ingredient/createIngredientFunctionRequest.vtl
      ResponseMappingTemplateS3Location: resolver/ingredient/createIngredientFunctionResponse.vtl

  AppSyncGetDiaryEntryFromIngredientFunction:
    Type: "AWS::AppSync::FunctionConfiguration"
    DependsOn: GraphQLSchema
    Properties:
      ApiId: !GetAtt AppSyncAPI.ApiId
      DataSourceName: !GetAtt AppSyncDataSource.Name
      FunctionVersion: 2018-05-29
      Name: getDiaryEntryFromIngredientFunction
      RequestMappingTemplateS3Location: resolver/ingredient/getDiaryEntryFromIngredientFunctionRequest.vtl
      ResponseMappingTemplate: "$util.toJson($ctx.result)"

  AppSyncLinkIngredientDiaryEntryFunction:
    Type: "AWS::AppSync::FunctionConfiguration"
    DependsOn: GraphQLSchema
    Properties:
      ApiId: !GetAtt AppSyncAPI.ApiId
      DataSourceName: !GetAtt AppSyncDataSource.Name
      FunctionVersion: 2018-05-29
      Name: linkIngredientDiaryEntryFunction
      RequestMappingTemplateS3Location: resolver/ingredient/linkIngredientDiaryEntryFunctionRequest.vtl
      # Note different response map. Return ingredient, not modified diary entry.
      ResponseMappingTemplate: "$util.toJson($ctx.stash.ingredient)"

  AppSyncUpdateIngredientMutationResolver:
    Type: "AWS::AppSync::Resolver"
    DependsOn: GraphQLSchema
    Properties:
      ApiId: !GetAtt AppSyncAPI.ApiId
      TypeName: Mutation
      FieldName: updateIngredient
      DataSourceName: !GetAtt AppSyncDataSource.Name
      RequestMappingTemplateS3Location: resolver/ingredient/updateIngredientRequest.vtl
      ResponseMappingTemplate: "$util.toJson($ctx.result)"

  AppSyncDeleteIngredientMutationResolver:
    Type: "AWS::AppSync::Resolver"
    DependsOn: GraphQLSchema
    Properties:
      ApiId: !GetAtt AppSyncAPI.ApiId
      TypeName: Mutation
      FieldName: deleteIngredient
      DataSourceName: !GetAtt AppSyncDataSource.Name
      RequestMappingTemplateS3Location: resolver/ingredient/deleteIngredientRequest.vtl
      ResponseMappingTemplate: "$util.toJson($ctx.result)"

  AppSyncDiaryEntryIngredientResolver:
    Type: "AWS::AppSync::Resolver"
    DependsOn: GraphQLSchema
    Properties:
      ApiId: !GetAtt AppSyncAPI.ApiId
      TypeName: Ingredient
      FieldName: mealEntry
      DataSourceName: !GetAtt AppSyncDataSource.Name
      RequestMappingTemplateS3Location: resolver/ingredient/getDiaryEntryRequest.vtl
      ResponseMappingTemplate: "$util.toJson($ctx.result)"

  AppSyncFoodIngredientResolver:
    Type: "AWS::AppSync::Resolver"
    DependsOn: GraphQLSchema
    Properties:
      ApiId: !GetAtt AppSyncAPI.ApiId
      TypeName: Ingredient
      FieldName: food
      DataSourceName: !GetAtt AppSyncDataSource.Name
      RequestMappingTemplateS3Location: resolver/ingredient/getFoodRequest.vtl
      ResponseMappingTemplate: "$util.toJson($ctx.result)"

# Medicine Resolvers

  AppSyncListMedicinesQueryResolver:
    Type: "AWS::AppSync::Resolver"
    DependsOn: GraphQLSchema
    Properties:
      ApiId: !GetAtt AppSyncAPI.ApiId
      TypeName: Query
      FieldName: listMedicines
      DataSourceName: !GetAtt AppSyncDataSource.Name
      RequestMappingTemplateS3Location: resolver/medicine/listMedicinesRequest.vtl
      ResponseMappingTemplate: "$util.toJson($context.result)"

  AppSyncGetMedicineQueryResolver:
    Type: "AWS::AppSync::Resolver"
    DependsOn: GraphQLSchema
    Properties:
      ApiId: !GetAtt AppSyncAPI.ApiId
      TypeName: Query
      FieldName: getMedicine
      DataSourceName: !GetAtt AppSyncDataSource.Name
      RequestMappingTemplateS3Location: resolver/medicine/getMedicineRequest.vtl
      ResponseMappingTemplate: "$util.toJson($ctx.result)"

  AppSyncCreateMedicineMutationResolver:
    Type: "AWS::AppSync::Resolver"
    DependsOn: GraphQLSchema
    Properties:
      ApiId: !GetAtt AppSyncAPI.ApiId
      TypeName: Mutation
      FieldName: createMedicine
      DataSourceName: !GetAtt AppSyncDataSource.Name
      RequestMappingTemplateS3Location: resolver/medicine/createMedicineRequest.vtl
      ResponseMappingTemplate: "$util.toJson($ctx.result)"

  AppSyncUpdateMedicineMutationResolver:
    Type: "AWS::AppSync::Resolver"
    DependsOn: GraphQLSchema
    Properties:
      ApiId: !GetAtt AppSyncAPI.ApiId
      TypeName: Mutation
      FieldName: updateMedicine
      DataSourceName: !GetAtt AppSyncDataSource.Name
      RequestMappingTemplateS3Location: resolver/medicine/updateMedicineRequest.vtl
      ResponseMappingTemplate: "$util.toJson($ctx.result)"

  AppSyncDeleteMedicineMutationResolver:
    Type: "AWS::AppSync::Resolver"
    DependsOn: GraphQLSchema
    Properties:
      ApiId: !GetAtt AppSyncAPI.ApiId
      TypeName: Mutation
      FieldName: deleteMedicine
      DataSourceName: !GetAtt AppSyncDataSource.Name
      RequestMappingTemplateS3Location: resolver/medicine/deleteMedicineRequest.vtl
      ResponseMappingTemplate: "$util.toJson($ctx.result)"

# Dose Resolvers

  AppSyncListDosesQueryResolver:
    Type: "AWS::AppSync::Resolver"
    DependsOn: GraphQLSchema
    Properties:
      ApiId: !GetAtt AppSyncAPI.ApiId
      TypeName: Query
      FieldName: listDoses
      DataSourceName: !GetAtt AppSyncDataSource.Name
      RequestMappingTemplateS3Location: resolver/dose/listDosesRequest.vtl
      ResponseMappingTemplate: "$util.toJson($context.result)"

  AppSyncGetDoseQueryResolver:
    Type: "AWS::AppSync::Resolver"
    DependsOn: GraphQLSchema
    Properties:
      ApiId: !GetAtt AppSyncAPI.ApiId
      TypeName: Query
      FieldName: getDose
      DataSourceName: !GetAtt AppSyncDataSource.Name
      RequestMappingTemplateS3Location: resolver/dose/getDoseRequest.vtl
      ResponseMappingTemplate: "$util.toJson($ctx.result)"

  AppSyncCreateDoseMutationResolver:
    Type: "AWS::AppSync::Resolver"
    DependsOn: GraphQLSchema
    Properties:
      ApiId: !GetAtt AppSyncAPI.ApiId
      TypeName: Mutation
      FieldName: createDose
      DataSourceName: !GetAtt AppSyncDataSource.Name
      RequestMappingTemplateS3Location: resolver/dose/createDoseRequest.vtl
      ResponseMappingTemplate: "$util.toJson($ctx.result)"

  AppSyncUpdateDoseMutationResolver:
    Type: "AWS::AppSync::Resolver"
    DependsOn: GraphQLSchema
    Properties:
      ApiId: !GetAtt AppSyncAPI.ApiId
      TypeName: Mutation
      FieldName: updateDose
      DataSourceName: !GetAtt AppSyncDataSource.Name
      RequestMappingTemplateS3Location: resolver/dose/updateDoseRequest.vtl
      ResponseMappingTemplate: "$util.toJson($ctx.result)"

  AppSyncDeleteDoseMutationResolver:
    Type: "AWS::AppSync::Resolver"
    DependsOn: GraphQLSchema
    Properties:
      ApiId: !GetAtt AppSyncAPI.ApiId
      TypeName: Mutation
      FieldName: deleteDose
      DataSourceName: !GetAtt AppSyncDataSource.Name
      RequestMappingTemplateS3Location: resolver/dose/deleteDoseRequest.vtl
      ResponseMappingTemplate: "$util.toJson($ctx.result)"

  AppSyncDoseDosageEntryResolver:
    Type: "AWS::AppSync::Resolver"
    DependsOn: GraphQLSchema
    Properties:
      ApiId: !GetAtt AppSyncAPI.ApiId
      TypeName: Dose
      FieldName: dosageEntry
      DataSourceName: !GetAtt AppSyncDataSource.Name
      RequestMappingTemplateS3Location: resolver/dose/getDosageEntryRequest.vtl
      ResponseMappingTemplate: "$util.toJson($ctx.result)"

  AppSyncDoseMedicineResolver:
    Type: "AWS::AppSync::Resolver"
    DependsOn: GraphQLSchema
    Properties:
      ApiId: !GetAtt AppSyncAPI.ApiId
      TypeName: Dose
      FieldName: medicine
      DataSourceName: !GetAtt AppSyncDataSource.Name
      RequestMappingTemplateS3Location: resolver/dose/getMedicineRequest.vtl
      ResponseMappingTemplate: "$util.toJson($ctx.result)"

# Diary Entry Resolvers

  AppSyncListDiaryEntriesQueryResolver:
    Type: "AWS::AppSync::Resolver"
    DependsOn: GraphQLSchema
    Properties:
      ApiId: !GetAtt AppSyncAPI.ApiId
      TypeName: Query
      FieldName: listDiaryEntries
      DataSourceName: !GetAtt AppSyncDataSource.Name
      RequestMappingTemplateS3Location: resolver/diaryEntry/listDiaryEntriesRequest.vtl
      ResponseMappingTemplate: "$util.toJson($context.result)"

  AppSyncGetDiaryEntryQueryResolver:
    Type: "AWS::AppSync::Resolver"
    DependsOn: GraphQLSchema
    Properties:
      ApiId: !GetAtt AppSyncAPI.ApiId
      TypeName: Query
      FieldName: getDiaryEntry
      DataSourceName: !GetAtt AppSyncDataSource.Name
      RequestMappingTemplateS3Location: resolver/diaryEntry/getDiaryEntryRequest.vtl
      ResponseMappingTemplate: "$util.toJson($ctx.result)"

  AppSyncCreateDiaryEntryMutationResolver:
    Type: "AWS::AppSync::Resolver"
    DependsOn: GraphQLSchema
    Properties:
      ApiId: !GetAtt AppSyncAPI.ApiId
      TypeName: Mutation
      FieldName: createDiaryEntry
      DataSourceName: !GetAtt AppSyncDataSource.Name
      RequestMappingTemplateS3Location: resolver/diaryEntry/createDiaryEntryRequest.vtl
      ResponseMappingTemplate: "$util.toJson($ctx.result)"

  AppSyncUpdateDiaryEntryMutationResolver:
    Type: "AWS::AppSync::Resolver"
    DependsOn: GraphQLSchema
    Properties:
      ApiId: !GetAtt AppSyncAPI.ApiId
      TypeName: Mutation
      FieldName: updateDiaryEntry
      DataSourceName: !GetAtt AppSyncDataSource.Name
      RequestMappingTemplateS3Location: resolver/diaryEntry/updateDiaryEntryRequest.vtl
      ResponseMappingTemplate: "$util.toJson($ctx.result)"

  AppSyncDeleteDiaryEntryMutationResolver:
    Type: "AWS::AppSync::Resolver"
    DependsOn: GraphQLSchema
    Properties:
      ApiId: !GetAtt AppSyncAPI.ApiId
      TypeName: Mutation
      FieldName: deleteDiaryEntry
      DataSourceName: !GetAtt AppSyncDataSource.Name
      RequestMappingTemplateS3Location: resolver/diaryEntry/deleteDiaryEntryRequest.vtl
      ResponseMappingTemplate: "$util.toJson($ctx.result)"

# Meal Entry Resolvers

  AppSyncCreateMealEntryMutationResolver:
    Type: "AWS::AppSync::Resolver"
    DependsOn: GraphQLSchema
    Properties:
      ApiId: !GetAtt AppSyncAPI.ApiId
      TypeName: Mutation
      FieldName: createMealEntry
      DataSourceName: !GetAtt AppSyncDataSource.Name
      RequestMappingTemplateS3Location: resolver/diaryEntry/createMealEntryRequest.vtl
      ResponseMappingTemplate: "$util.toJson($ctx.result)"

  AppSyncUpdateMealEntryMutationResolver:
    Type: "AWS::AppSync::Resolver"
    DependsOn: GraphQLSchema
    Properties:
      ApiId: !GetAtt AppSyncAPI.ApiId
      TypeName: Mutation
      FieldName: updateMealEntry
      DataSourceName: !GetAtt AppSyncDataSource.Name
      RequestMappingTemplateS3Location: resolver/diaryEntry/updateDiaryEntryRequest.vtl
      ResponseMappingTemplate: "$util.toJson($ctx.result)"

# BowelMovement Entry Resolvers

  AppSyncCreateBowelMovementEntryMutationResolver:
    Type: "AWS::AppSync::Resolver"
    DependsOn: GraphQLSchema
    Properties:
      ApiId: !GetAtt AppSyncAPI.ApiId
      TypeName: Mutation
      FieldName: createBowelMovementEntry
      DataSourceName: !GetAtt AppSyncDataSource.Name
      RequestMappingTemplateS3Location: resolver/diaryEntry/createBowelMovementEntryRequest.vtl
      ResponseMappingTemplate: "$util.toJson($ctx.result)"

  AppSyncUpdateBowelMovementEntryMutationResolver:
    Type: "AWS::AppSync::Resolver"
    DependsOn: GraphQLSchema
    Properties:
      ApiId: !GetAtt AppSyncAPI.ApiId
      TypeName: Mutation
      FieldName: updateBowelMovementEntry
      DataSourceName: !GetAtt AppSyncDataSource.Name
      RequestMappingTemplateS3Location: resolver/diaryEntry/updateDiaryEntryRequest.vtl
      ResponseMappingTemplate: "$util.toJson($ctx.result)"

# Dosage Entry Resolvers

  AppSyncCreateDosageEntryMutationResolver:
    Type: "AWS::AppSync::Resolver"
    DependsOn: GraphQLSchema
    Properties:
      ApiId: !GetAtt AppSyncAPI.ApiId
      TypeName: Mutation
      FieldName: createDosageEntry
      DataSourceName: !GetAtt AppSyncDataSource.Name
      RequestMappingTemplateS3Location: resolver/diaryEntry/createDosageEntryRequest.vtl
      ResponseMappingTemplate: "$util.toJson($ctx.result)"

  AppSyncUpdateDosageEntryMutationResolver:
    Type: "AWS::AppSync::Resolver"
    DependsOn: GraphQLSchema
    Properties:
      ApiId: !GetAtt AppSyncAPI.ApiId
      TypeName: Mutation
      FieldName: updateDosageEntry
      DataSourceName: !GetAtt AppSyncDataSource.Name
      RequestMappingTemplateS3Location: resolver/diaryEntry/updateDiaryEntryRequest.vtl
      ResponseMappingTemplate: "$util.toJson($ctx.result)"

# Symptom Entry Resolvers

  AppSyncCreateSymptomEntryMutationResolver:
    Type: "AWS::AppSync::Resolver"
    DependsOn: GraphQLSchema
    Properties:
      ApiId: !GetAtt AppSyncAPI.ApiId
      TypeName: Mutation
      FieldName: createSymptomEntry
      DataSourceName: !GetAtt AppSyncDataSource.Name
      RequestMappingTemplateS3Location: resolver/diaryEntry/createSymptomEntryRequest.vtl
      ResponseMappingTemplate: "$util.toJson($ctx.result)"

  AppSyncUpdateSymptomEntryMutationResolver:
    Type: "AWS::AppSync::Resolver"
    DependsOn: GraphQLSchema
    Properties:
      ApiId: !GetAtt AppSyncAPI.ApiId
      TypeName: Mutation
      FieldName: updateSymptomEntry
      DataSourceName: !GetAtt AppSyncDataSource.Name
      RequestMappingTemplateS3Location: resolver/diaryEntry/updateDiaryEntryRequest.vtl
      ResponseMappingTemplate: "$util.toJson($ctx.result)"

  # General

  AppSyncDeleteItemMutationResolver:
    Type: "AWS::AppSync::Resolver"
    DependsOn: GraphQLSchema
    Properties:
      ApiId: !GetAtt AppSyncAPI.ApiId
      TypeName: Mutation
      FieldName: deleteItem
      DataSourceName: !GetAtt AppSyncDataSource.Name
      RequestMappingTemplateS3Location: resolver/deleteItemRequest.vtl
      ResponseMappingTemplate: "$util.toJson($ctx.result)"

Outputs:
  GutAITableName:
    Description: The name of the DynamoDB Table
    Value: !Ref GutAITable
  GraphQLApiEndpoint:
    Description: The URL to the GraphQL Endpoint
    Value: !GetAtt AppSyncAPI.GraphQLUrl
  GraphQLApiId:
    Description: The API ID of the GraphQL API
    Value: !GetAtt AppSyncAPI.ApiId